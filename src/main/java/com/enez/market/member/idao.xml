<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.enez.market.member.Service">
	<insert id="membersave">
		insert into reset_user (user_id, member_id,
		member_pw, member_name, address, phone, nickname, category_check1,
		profile_image)
		values(user_id_seq.nextval, #{param1},
		#{param2}, #{param3}, #{param4},
		#{param5}, #{param6}, #{param7},
		#{param8})
	</insert>

	<insert id="membersave1">
		insert into reset_user (user_id, member_id, member_pw, member_name, address,
		phone, nickname, category_check1, profile_image)
		values(user_id_seq.nextval, #{param1}, #{param2}, #{param3},
		#{param4}, #{param5}, #{param6}, #{param7},'default_image.jpg')

	</insert>

	<select id="idch" resultType="int">
		select count(*) from reset_user
		where member_id=#{param1}
	</select>

	<select id="nickch" resultType="int">
		select count(*) from reset_user
		where nickname=#{param1}
	</select>
	<select id="printmember"
		resultType="com.enez.market.member.MemberDTO">
		select * from reset_user
	</select>

	<select id="loginok"
		resultType="com.enez.market.member.MemberDTO">
		select member_id from reset_user where member_id=#{param1}
		and member_pw=#{param2}
	</select>
	<select id="idresult" resultType="String">
		select member_id from
		reset_user where member_name=#{param1} and phone=#{param2}
	</select>
	<update id="pwresult">
		update reset_user set member_pw = #{param4} where
		member_id = #{param1} and
		member_name = #{param2} and phone = #{param3}
	</update>

	<select id="select"
		resultType="com.enez.market.member.MemberDTO">
		select user_id,member_id,member_pw,member_name,address,phone,manner,
		nickname,category_check1,profile_image,intro,EXTRACT(DAY FROM sysdate - stdate)as gaip,readcnt from reset_user
		where member_id = #{param1}
	</select>

	<update id="modify">
		update reset_user set member_pw = #{param2} , phone =
		#{param3} , address = #{param4} , nickname = #{param5} , profile_image
		= #{param6} where member_id =
		#{param1}
	</update>

	<update id="modify_2">
		update reset_user set member_pw = #{param2} , phone =
		#{param3} , address = #{param4} , nickname = #{param5} , profile_image
		= #{param6} where member_id =
		#{param1}
	</update>

	<select id="oldimg" resultType="String">
		select profile_image from
		reset_user where member_id = #{param1}
	</select>

	<delete id="resign">
		delete from reset_user where member_id = #{param1}
		and member_pw = #{param2}
	</delete>

	<delete id="member_delete">
		delete from reset_user where member_id = #{param1}

	</delete>
	
	<update id="itrsave">
		update reset_user set intro = #{param2} where member_id = #{param1}
	</update>
	
	<select id="sdpage" resultType="com.enez.market.member.MemberDTO">
		select * from reset_user where nickname = #{param1}
	</select>
	
	
	<select id="sdnick" resultType="String">
		select member_id from reset_user where nickname = #{param1}
	</select>
	
	<update id="readcnt">
		update reset_user set readcnt=readcnt+1 where member_id = #{param1}
	</update>
	
	<select id="product_out" resultType="com.enez.market.product.ProductDTO">
	select * from product where seller_id = #{param1}		
	</select>
	
	
	
<select id="search_name" resultType="com.enez.market.member.MemberDTO">
      select * from reset_user where member_name like  '%' || #{param1} || '%'
   </select>
   
   <select id="search_phone" resultType="com.enez.market.member.MemberDTO">
      select * from reset_user where phone like  '%' || #{param1} || '%'
   </select>
   
   <select id="search_id" resultType="com.enez.market.member.MemberDTO">
      select * from reset_user where member_id like  '%' || #{param1} || '%'
   </select>
	
	
	
	<select id="sortnew" resultType="com.enez.market.product.ProductDTO">
   SELECT product_no,seller_id,category_name,buyer_id,price,title,detail,product_state,location,
    product_image,view_cnt,create_at,update_at,CASE WHEN EXTRACT(DAY FROM SYSDATE - update_at) = 0 THEN 
    TO_CHAR(EXTRACT(MINUTE FROM SYSDATE - update_at)) || '분 전'
    WHEN EXTRACT(DAY FROM SYSDATE - update_at) = 0 THEN
    TO_CHAR(TRUNC(MOD(EXTRACT(HOUR FROM SYSDATE - update_at), 24))) || '시간 전'
    WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, update_at) / 12) >= 1 THEN
    TO_CHAR(TRUNC(MONTHS_BETWEEN(SYSDATE, update_at) / 12)) || '년 전'
    WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, update_at)) >=1 THEN
    TO_CHAR(TRUNC(MONTHS_BETWEEN(SYSDATE, update_at))) || '달 전'
    ELSE TO_CHAR(EXTRACT(DAY FROM SYSDATE - update_at)) || '일 전'
    END as period FROM product WHERE seller_id = #{param1}   order by update_at desc      
   </select> 
</mapper>