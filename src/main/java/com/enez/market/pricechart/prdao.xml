<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.enez.market.pricechart.Service">
<select id="findchart_count" resultType="com.enez.market.pricechart.Product_search_DTO">
select PRODUCT_NO, SELLER_ID, CATEGORY_NAME, BUYER_ID, PRICE, TITLE, DETAIL, LOCATION, PRODUCT_STATE, PRODUCT_IMAGE, VIEW_CNT, CREATE_AT, UPDATE_AT from PRODUCT 
where title like '%'||#{find_name}||'%' order by view_cnt DESC
</select>
<select id="findchart_date" resultType="com.enez.market.pricechart.Product_search_DTO">
select PRODUCT_NO, SELLER_ID, CATEGORY_NAME, BUYER_ID, PRICE, TITLE, DETAIL, LOCATION, PRODUCT_STATE, PRODUCT_IMAGE, VIEW_CNT, CREATE_AT, UPDATE_AT from PRODUCT 
where title like '%'||#{find_name}||'%' order by CREATE_AT DESC
</select>

<select id="findchart_dateAvgSet" resultType="com.enez.market.pricechart.Product_chart_DTO">
<![CDATA[
SELECT 
	   p. PRICE,
    concat(concat(SUBSTR(update_at, 1, 2),'-'),concat(SUBSTR(update_at, 4, 2),'월')) as update_at
	    FROM
	        product p 
	    WHERE
	        TITLE LIKE '%'||#{param1}||'%'
	     order by p.update_at ASC
]]> 
</select>

<select id="getAddress" resultType="com.enez.market.pricechart.addMap_DTO">
select PRODUCT_NO,LOCATION from PRODUCT where ((PRODUCT_STATE !='판매완료' and PRODUCT_STATE !='거래중' )  or PRODUCT_STATE is null)
</select>

<delete id="mapDelete" >
delete from PRODUCTADDRESS
</delete>
<insert id="resetMapData">
insert into PRODUCTADDRESS ( PR_NO, ADDRESSX, ADDRESSY, CODE) values(#{param1},#{param2},#{param3},#{param4})
</insert>
<select id="mapProductList" resultType="com.enez.market.pricechart.Product_search_DTO" >
select PRODUCT_NO, CATEGORY_NAME, BUYER_ID, PRICE, TITLE,PRODUCT_STATE, LOCATION, PRODUCT_IMAGE, VIEW_CNT
from PRODUCT where PRODUCT_NO = #{param1} and ((PRODUCT_STATE !='판매완료' and PRODUCT_STATE !='거래중' )  or PRODUCT_STATE is null)
</select>

<select id="mapdata" resultType="com.enez.market.pricechart.addMap_DTO2" >
select * from PRODUCTADDRESS
</select>
</mapper>